# System Architecture Diagrams

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           User Interface Layer                              │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                    React Frontend (TypeScript)                        │  │
│  │  - Job Submission Form                                               │  │
│  │  - Job List View                                                     │  │
│  │  - Job Detail View                                                   │  │
│  │  - Real-time Status Updates                                          │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    │ HTTP/REST                               │
│                                    ▼                                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          API Gateway Layer                                  │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                    FastAPI Backend (Python)                          │  │
│  │  - REST API Endpoints                                                │  │
│  │  - Request Validation                                                │  │
│  │  - Business Logic                                                    │  │
│  │  - Database Operations                                               │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                    ┌───────────────┴───────────────┐                       │
│                    │                               │                         │
│                    ▼                               ▼                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                         Data Persistence Layer                              │
│                                                                             │
│  ┌──────────────────────────────────┐  ┌─────────────────────────────────┐ │
│  │      PostgreSQL / SQLite        │  │      SQLAlchemy ORM            │ │
│  │  - Jobs Table                    │  │  - Database Abstraction        │ │
│  │  - Tasks Table                    │  │  - Query Optimization         │ │
│  │  - Status Tracking                │  │  - Transaction Management     │ │
│  └──────────────────────────────────┘  └─────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        Message Queue Layer                                  │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                    AWS SQS / LocalStack                              │  │
│  │  - Task Queue (tasks)                                                │  │
│  │  - Dead Letter Queue (tasks-dlq)                                     │  │
│  │  - Message Visibility Timeout                                        │  │
│  │  - Long Polling Support                                              │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                    │                                         │
│                                    │ Poll Messages                           │
│                                    ▼                                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        Compute Layer (Kubernetes)                           │
│                                                                             │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐        │
│  │  Worker Pod 1    │  │  Worker Pod 2    │  │  Worker Pod N    │        │
│  │                  │  │                  │  │                  │        │
│  │  - Poll SQS      │  │  - Poll SQS      │  │  - Poll SQS      │        │
│  │  - Process Tasks │  │  - Process Tasks │  │  - Process Tasks │        │
│  │  - Update API    │  │  - Update API    │  │  - Update API    │        │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘        │
│                                    │                                         │
│                                    │ Status Updates                          │
│                                    ▼                                         │
│                          ┌──────────────────┐                               │
│                          │  Backend API     │                               │
│                          └──────────────────┘                               │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Detailed Component Flow

```
┌─────────────┐
│   User      │
│  (Browser)  │
└──────┬──────┘
       │
       │ 1. Submit Job
       │ POST /api/v1/jobs
       │ {job_type, num_tasks, parameters}
       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FastAPI Backend                              │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  JobService.create_job()                                 │   │
│  │  1. Create Job Record (Database)                         │   │
│  │  2. Generate Tasks (Database)                            │   │
│  │  3. Enqueue Tasks to SQS                                 │   │
│  │  4. Update Job Status: ENQUEUED                          │   │
│  └──────────────────────────────────────────────────────────┘   │
└──────┬──────────────────────────────────────────────────────────┘
       │
       │ 2. Store in Database
       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Database (PostgreSQL/SQLite)                 │
│  ┌──────────────┐          ┌──────────────┐                   │
│  │   Jobs       │          │   Tasks      │                   │
│  │  - id        │◄─────────│  - id        │                   │
│  │  - status    │          │  - job_id    │                   │
│  │  - total     │          │  - status    │                   │
│  │  - completed │          │  - parameters│                   │
│  └──────────────┘          └──────────────┘                   │
└─────────────────────────────────────────────────────────────────┘

       │ 3. Send Messages
       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    AWS SQS / LocalStack                         │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  Queue: tasks                                           │   │
│  │  ┌────────────────────────────────────────────────────┐ │   │
│  │  │ Message: {task_id, job_id, task_index, parameters}│ │   │
│  │  │ Message: {task_id, job_id, task_index, parameters}│ │   │
│  │  │ Message: {task_id, job_id, task_index, parameters}│ │   │
│  │  └────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
       │
       │ 4. Poll Queue (Long Polling)
       ▼
┌─────────────────────────────────────────────────────────────────┐
│              Kubernetes Worker Pods                             │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Worker Process                                           │  │
│  │  1. Receive Messages from SQS                            │  │
│  │  2. Mark Task as RUNNING (API Call)                      │  │
│  │  3. Process Task (CPU/IO Bound Work)                     │  │
│  │  4. Mark Task as COMPLETED (API Call)                    │  │
│  │  5. Delete Message from SQS                              │  │
│  └──────────────────────────────────────────────────────────┘  │
└──────┬──────────────────────────────────────────────────────────┘
       │
       │ 5. Status Updates
       │ POST /api/v1/tasks/{id}/running
       │ POST /api/v1/tasks/{id}/complete
       ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FastAPI Backend                              │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │  TaskService                                              │   │
│  │  1. Update Task Status                                    │   │
│  │  2. Update Job Statistics                                 │   │
│  │  3. Check if Job Complete                                 │   │
│  │  4. Update Job Status if needed                           │   │
│  └──────────────────────────────────────────────────────────┘   │
└──────┬──────────────────────────────────────────────────────────┘
       │
       │ 6. Poll for Updates
       │ GET /api/v1/jobs/{id}
       ▼
┌─────────────┐
│   User      │
│  (Browser)  │
│  Sees Job   │
│  Status     │
└─────────────┘
```

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Development Environment                           │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │  Host Machine (macOS/Windows/Linux)                                   │  │
│  │                                                                       │  │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐   │  │
│  │  │  React Frontend │  │  FastAPI Backend │  │  LocalStack      │   │  │
│  │  │  Port: 3000     │  │  Port: 8000      │  │  Port: 4566      │   │  │
│  │  │  (Vite Dev)     │  │  (Uvicorn)       │  │  (SQS Emulator)  │   │  │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘   │  │
│  │                                                                       │  │
│  │  ┌──────────────────────────────────────────────────────────────┐   │  │
│  │  │  SQLite Database (backend/jobdb.db)                         │   │  │
│  │  └──────────────────────────────────────────────────────────────┘   │  │
│  │                                                                       │  │
│  │  ┌──────────────────────────────────────────────────────────────┐   │  │
│  │  │  Docker Network: kind                                        │   │  │
│  │  │  ┌────────────────────────────────────────────────────────┐   │   │  │
│  │  │  │  kind Cluster (Kubernetes)                            │   │   │  │
│  │  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐│   │   │  │
│  │  │  │  │ Worker Pod 1 │  │ Worker Pod 2 │  │ Worker Pod 3 ││   │   │  │
│  │  │  │  │              │  │              │  │              ││   │   │  │
│  │  │  │  │ Connects to: │  │ Connects to: │  │ Connects to: ││   │   │  │
│  │  │  │  │ - LocalStack │  │ - LocalStack │  │ - LocalStack ││   │   │  │
│  │  │  │  │   (via K8s   │  │   (via K8s   │  │   (via K8s   ││   │   │  │
│  │  │  │  │    Service)  │  │    Service)  │  │    Service)  ││   │   │  │
│  │  │  │  │ - Backend API│  │ - Backend API│  │ - Backend API││   │   │  │
│  │  │  │  │   (host.docker│  │   (host.docker│  │   (host.docker││   │   │  │
│  │  │  │  │    .internal) │  │    .internal) │  │    .internal) ││   │   │  │
│  │  │  │  └──────────────┘  └──────────────┘  └──────────────┘│   │   │  │
│  │  │  │                                                    │   │   │  │
│  │  │  │  ┌──────────────────────────────────────────────┐ │   │   │  │
│  │  │  │  │  Kubernetes Service: localstack              │ │   │   │  │
│  │  │  │  │  Endpoints: 172.19.0.3:4566                  │ │   │   │  │
│  │  │  │  └──────────────────────────────────────────────┘ │   │   │  │
│  │  │  └────────────────────────────────────────────────────────┘   │   │  │
│  │  └──────────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                        Production Environment (Future)                       │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │  AWS Cloud                                                          │  │
│  │                                                                     │  │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐ │  │
│  │  │  CloudFront      │  │  API Gateway     │  │  Step Functions  │ │  │
│  │  │  (CDN)           │  │  / Lambda        │  │  (Orchestration)  │ │  │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘ │  │
│  │                                                                     │  │
│  │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐ │  │
│  │  │  RDS PostgreSQL  │  │  SQS Queues      │  │  EKS Cluster     │ │  │
│  │  │  (Database)      │  │  (Messaging)     │  │  (Compute)       │ │  │
│  │  └──────────────────┘  └──────────────────┘  └──────────────────┘ │  │
│  │                                                                     │  │
│  │  ┌──────────────────────────────────────────────────────────────┐   │  │
│  │  │  EKS Worker Nodes                                           │   │  │
│  │  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │   │  │
│  │  │  │ Worker Pod 1 │  │ Worker Pod 2 │  │ Worker Pod N │      │   │  │
│  │  │  └──────────────┘  └──────────────┘  └──────────────┘      │   │  │
│  │  └──────────────────────────────────────────────────────────────┘   │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Data Flow Sequence

```
Time →

User          Frontend         Backend API      Database        SQS Queue      Worker Pods
  │               │                 │              │               │                │
  │──Submit Job───▶                 │              │               │                │
  │               │                 │              │               │                │
  │               │──POST /jobs─────▶               │               │                │
  │               │                 │              │               │                │
  │               │                 │──Create Job──▶               │                │
  │               │                 │              │               │                │
  │               │                 │──Create Tasks▶               │                │
  │               │                 │              │               │                │
  │               │                 │──Enqueue─────┼───────────────▶                │
  │               │                 │              │               │                │
  │               │◀──Job Response──│              │               │                │
  │◀──Job Created──│                 │              │               │                │
  │               │                 │              │               │                │
  │               │                 │              │               │◀──Poll Queue───│
  │               │                 │              │               │                │
  │               │                 │              │               │──Receive Msg──▶
  │               │                 │              │               │                │
  │               │                 │◀──Mark Running───────────────┼───────────────│
  │               │                 │              │               │                │
  │               │                 │──Update Task─▶               │                │
  │               │                 │              │               │                │
  │               │                 │              │               │──Process Task──│
  │               │                 │              │               │                │
  │               │                 │◀──Mark Complete───────────────┼───────────────│
  │               │                 │              │               │                │
  │               │                 │──Update Task─▶               │                │
  │               │                 │              │               │                │
  │               │                 │──Update Job──▶               │                │
  │               │                 │              │               │                │
  │               │                 │              │               │──Delete Msg────▶
  │               │                 │              │               │                │
  │──Poll Status──┼─────────────────┼──────────────┼───────────────┼───────────────│
  │               │                 │              │               │                │
  │               │──GET /jobs/{id}▶               │               │                │
  │               │                 │              │               │                │
  │               │◀──Job Status────│              │               │                │
  │◀──Status Update│                 │              │               │                │
```

## Network Topology

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Network Architecture                                │
│                                                                             │
│  Host Network (172.20.0.0/16)                                               │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │  LocalStack Container                                                │  │
│  │  IP: 172.20.0.2                                                      │  │
│  │  Port: 4566 (SQS)                                                    │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│  Kind Network (172.19.0.0/16)                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │  Kubernetes Cluster                                                  │  │
│  │  ┌────────────────────────────────────────────────────────────────┐  │  │
│  │  │  Control Plane Node                                            │  │  │
│  │  │  IP: 172.19.0.2                                                 │  │  │
│  │  └────────────────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────────────────┐  │  │
│  │  │  Worker Pods                                                   │  │  │
│  │  │  IP Range: 10.244.0.0/16                                       │  │  │
│  │  │                                                                │  │  │
│  │  │  ┌──────────────────────────────────────────────────────────┐ │  │  │
│  │  │  │  Kubernetes Service: localstack                          │ │  │  │
│  │  │  │  ClusterIP: 10.96.x.x                                   │ │  │  │
│  │  │  │  Endpoints: 172.19.0.3:4566 (LocalStack on kind network)│ │  │  │
│  │  │  └──────────────────────────────────────────────────────────┘ │  │  │
│  │  └────────────────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                             │
│  Bridge Connection                                                          │
│  LocalStack is connected to both networks via docker network connect        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

